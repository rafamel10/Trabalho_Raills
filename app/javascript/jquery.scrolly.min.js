// jquery_scrolly.js v1.0.0-dev | Licensed under the MIT license
var JQueryScrolly = {
  calculate_offset: function(selector, options) {
    var element = jQuery(selector);
    if (element.length === 0) return null;

    var anchor = options.anchor;
    if (!anchor) return null;

    var offset = element.offset()[anchor];
    if (anchor === "middle") {
      offset -= (jQuery(window).height() - element.outerHeight()) / 2;
    } else {
      offset = Math.max(offset, 0);
    }

    if (options.offset) {
      offset -= options.offset;
    }

    return offset;
  },

  setup_scroll_events: function(selector, options) {
    var element = jQuery(selector);
    if (element.length === 0) return element;
    if (element.length > 1) return element;

    var href = element.attr("href");
    if (!href || href.length < 2 || href[0] !== "#") return element;

    options = Object.assign({
      anchor: "top",
      easing: "swing",
      offset: 0,
      parent: jQuery("body,html"),
      poll_once: false,
      speed: 1000
    }, options);

    var offset = options.poll_once ? JQueryScrolly.calculate_offset(href, options) : null;

    element.off("click.scrolly").on("click.scrolly", function(event) {
      var target_offset = offset === null ? JQueryScrolly.calculate_offset(href, options) : offset;
      if (target_offset !== null) {
        event.preventDefault();
        options.parent.stop().animate({ scrollTop: target_offset }, options.speed, options.easing);
      }
    });

    return element;
  },

  setup: function(selector, options) {
    return JQueryScrolly.setup_scroll_events(selector, options);
  }
};
